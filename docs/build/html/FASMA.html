
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <title>FASMA package &#8212; FASMA 2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="fasma-package">
<h1>FASMA package<a class="headerlink" href="#fasma-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="FASMA.tests.html">FASMA.tests package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="FASMA.tests.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="FASMA.tests.html#module-FASMA.tests.test_FASMA">FASMA.tests.test_FASMA module</a></li>
<li class="toctree-l2"><a class="reference internal" href="FASMA.tests.html#module-FASMA.tests">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-FASMA.fasma">
<span id="fasma-fasma-module"></span><h2>FASMA.fasma module<a class="headerlink" href="#module-FASMA.fasma" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-FASMA.interpolation">
<span id="fasma-interpolation-module"></span><h2>FASMA.interpolation module<a class="headerlink" href="#module-FASMA.interpolation" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="FASMA.interpolation.interpolator">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">interpolator</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">abund=0.0</em>, <em class="sig-param">elem=False</em>, <em class="sig-param">save=True</em>, <em class="sig-param">atmtype='apogee_kurucz'</em>, <em class="sig-param">result=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#interpolator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.interpolator" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to connect all. For a given set of params, return a model atmosphere.</p>
<dl class="simple">
<dt>params<span class="classifier">list of length 3</span></dt><dd><p>Teff, logg, [Fe/H].</p>
</dd>
<dt>abund<span class="classifier">float</span></dt><dd><p>abundance of a given element to added in the atmosphere.</p>
</dd>
<dt>element<span class="classifier">float</span></dt><dd><p>any element to change abundance in the atmosphere.</p>
</dd>
<dt>save<span class="classifier">bool</span></dt><dd><p>Whether the new atmosphere should be saved. Default is True.</p>
</dd>
<dt>atmtype<span class="classifier">str</span></dt><dd><p>The atmosphere models being used. Default is apogee_kurucz.</p>
</dd>
<dt>result<span class="classifier">bool</span></dt><dd><p>return the new atmosphere. Default is False.</p>
</dd>
</dl>
<dl class="simple">
<dt>newatm<span class="classifier">ndarray</span></dt><dd><p>New interpolated atmosphere.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="FASMA.interpolation.interpolator_kurucz">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">interpolator_kurucz</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">atmtype='apogee_kurucz'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#interpolator_kurucz"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.interpolator_kurucz" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolation for Kurucz model atmospheres.
Input
—–
params : ndarray</p>
<blockquote>
<div><p>Stellar parameters for the Interpolation.</p>
</div></blockquote>
<dl class="simple">
<dt>newatm<span class="classifier">ndarray</span></dt><dd><p>The interpolated atmosphere, the columns and tauross in a tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="FASMA.interpolation.interpolator_marcs">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">interpolator_marcs</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">fesun=7.47</em>, <em class="sig-param">microlim=3.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#interpolator_marcs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.interpolator_marcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Interpolation for marcs models. The function is taken from STEPAR
(Tabernero et al. 2019) to deal the gaps in the grid.
Input
—–
params : ndarray</p>
<blockquote>
<div><p>Stellar parameters for the Interpolation.</p>
</div></blockquote>
<dl class="simple">
<dt>newatm<span class="classifier">ndarray</span></dt><dd><p>The interpolated atmosphere, the columns and tauross in a tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="FASMA.interpolation.read_model">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">read_model</code><span class="sig-paren">(</span><em class="sig-param">fname</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#read_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.read_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the KURUCZ model atmosphere.</p>
<dl class="simple">
<dt>fname<span class="classifier">str</span></dt><dd><p>The gz file of the model atmosphere.</p>
</dd>
</dl>
<dl class="simple">
<dt>model<span class="classifier">ndarray</span></dt><dd><p>The correct atmosphere, the columns and tauross in a tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="FASMA.interpolation.save_model">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">save_model</code><span class="sig-paren">(</span><em class="sig-param">model</em>, <em class="sig-param">params</em>, <em class="sig-param">abund=0.0</em>, <em class="sig-param">elem=False</em>, <em class="sig-param">type='apogee_kurucz'</em>, <em class="sig-param">fout='out.atm'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#save_model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.save_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Save the model atmosphere in the right format.</p>
<dl class="simple">
<dt>model<span class="classifier">ndarray</span></dt><dd><p>The interpolated model atmosphere.</p>
</dd>
<dt>params<span class="classifier">list</span></dt><dd><p>Teff, logg, [M/H], vt of the interpolated atmosphere.</p>
</dd>
<dt>abund<span class="classifier">float</span></dt><dd><p>abundance of a given element to added in the atmosphere.</p>
</dd>
<dt>element<span class="classifier">float</span></dt><dd><p>any element to change abundance in the atmosphere.</p>
</dd>
<dt>type<span class="classifier">str</span></dt><dd><p>Type of atmospheric parameters. Default is apogee_kurucz</p>
</dd>
<dt>fout<span class="classifier">str</span></dt><dd><p>Name of the saved atmosphere. Default is out.atm</p>
</dd>
</dl>
<p>Saved atmospheric model in file.</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.interpolation.solar_abundance">
<code class="sig-prename descclassname">FASMA.interpolation.</code><code class="sig-name descname">solar_abundance</code><span class="sig-paren">(</span><em class="sig-param">element</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/interpolation.html#solar_abundance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.interpolation.solar_abundance" title="Permalink to this definition">¶</a></dt>
<dd><p>For a given atomic number, return solar abundance from Asplund et al. 2009.</p>
<dl class="simple">
<dt>element<span class="classifier">str</span></dt><dd><p>The name of an element</p>
</dd>
</dl>
<dl class="simple">
<dt>index<span class="classifier">int</span></dt><dd><p>The atomic number of the element</p>
</dd>
<dt>abundance<span class="classifier">float</span></dt><dd><p>The solar abundance of the atom in dex</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-FASMA.minimization">
<span id="fasma-minimization-module"></span><h2>FASMA.minimization module<a class="headerlink" href="#module-FASMA.minimization" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="FASMA.minimization.MinimizeSynth">
<em class="property">class </em><code class="sig-prename descclassname">FASMA.minimization.</code><code class="sig-name descname">MinimizeSynth</code><span class="sig-paren">(</span><em class="sig-param">p0</em>, <em class="sig-param">xobs</em>, <em class="sig-param">yobs</em>, <em class="sig-param">ranges</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Minimize the chi square function between a synthetic spectrum to an observed.</p>
<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.bounds">
<code class="sig-name descname">bounds</code><span class="sig-paren">(</span><em class="sig-param">i</em>, <em class="sig-param">p</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.bounds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.bounds" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to check if parameters during minimization are within bounds.
Input
—–
p: parameter we want to check;
i: the index of the bounds we want to check.</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.convergence_info">
<code class="sig-name descname">convergence_info</code><span class="sig-paren">(</span><em class="sig-param">res</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.convergence_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.convergence_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Information on convergence from mpfit function. All values greater
than zero can represent success (however status == 5 may indicate failure
to converge).
If the fit is unweighted (i.e. no errors were given, or the weights
were uniformly set to unity), then .perror will probably not represent
the true parameter uncertainties.
<em>If</em> you can assume that the true reduced chi-squared value is unity –
meaning that the fit is implicitly assumed to be of good quality –
then the estimated parameter uncertainties can be computed by scaling
.perror by the measured chi-squared value.</p>
<p>res : ndarray
the result of the mpfit function</p>
<p>parameters : ndarray
stellar parameters or abundances with their errors</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.exclude_bad_points">
<code class="sig-name descname">exclude_bad_points</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.exclude_bad_points"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.exclude_bad_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to exclude points from the spectrum, e.g. lines which are not
in line list by comparing observations with the best synthetic model.</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.minimize">
<code class="sig-name descname">minimize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.minimize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.minimize" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to glue the minimization together. Set the minimization options here.</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.minimizeElement">
<code class="sig-name descname">minimizeElement</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.minimizeElement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.minimizeElement" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.myfunct">
<code class="sig-name descname">myfunct</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.myfunct"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.myfunct" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that returns the weighted deviates (to be minimized).</p>
<dl class="simple">
<dt>p<span class="classifier">list</span></dt><dd><p>Parameters to be minimized</p>
</dd>
</dl>
<dl class="simple">
<dt>(y-ymodel)/err<span class="classifier">ndarray</span></dt><dd><p>Model deviation from observation</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="FASMA.minimization.MinimizeSynth.parinfo_limit">
<code class="sig-name descname">parinfo_limit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#MinimizeSynth.parinfo_limit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.MinimizeSynth.parinfo_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Smart way to calculate the bounds of each of parameters depending on
the grid of model atmospheres.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="FASMA.minimization.getMac">
<code class="sig-prename descclassname">FASMA.minimization.</code><code class="sig-name descname">getMac</code><span class="sig-paren">(</span><em class="sig-param">teff</em>, <em class="sig-param">logg</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#getMac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.getMac" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate macroturbulence.
For hotter dwarfs: Doyle et al. 2014
5200 &lt; teff &lt; 6400 K
4.0 &lt; logg &lt; 4.6 dex
For cooler dwarfs: Valenti et al. 2005
For subgiants and giants (logg &lt; 3.80 dex): Hekker &amp; Melendez 2007</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.minimization.getMic">
<code class="sig-prename descclassname">FASMA.minimization.</code><code class="sig-name descname">getMic</code><span class="sig-paren">(</span><em class="sig-param">teff</em>, <em class="sig-param">logg</em>, <em class="sig-param">feh</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/minimization.html#getMic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.minimization.getMic" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate microturbulence.</p>
</dd></dl>

</div>
<div class="section" id="module-FASMA.mpfit">
<span id="fasma-mpfit-module"></span><h2>FASMA.mpfit module<a class="headerlink" href="#module-FASMA.mpfit" title="Permalink to this headline">¶</a></h2>
<p>Perform Levenberg-Marquardt least-squares minimization, based on MINPACK-1.</p>
<blockquote>
<div><blockquote>
<div><blockquote>
<div><p>AUTHORS</p>
</div></blockquote>
<p>The original version of this software, called LMFIT, was written in FORTRAN
as part of the MINPACK-1 package by XXX.</p>
<p>Craig Markwardt converted the FORTRAN code to IDL.  The information for the
IDL version is:</p>
<blockquote>
<div><p>Craig B. Markwardt, NASA/GSFC Code 662, Greenbelt, MD 20770
<a class="reference external" href="mailto:craigm&#37;&#52;&#48;lheamail&#46;gsfc&#46;nasa&#46;gov">craigm<span>&#64;</span>lheamail<span>&#46;</span>gsfc<span>&#46;</span>nasa<span>&#46;</span>gov</a>
UPDATED VERSIONs can be found on my WEB PAGE:</p>
<blockquote>
<div><p><a class="reference external" href="http://cow.physics.wisc.edu/~craigm/idl/idl.html">http://cow.physics.wisc.edu/~craigm/idl/idl.html</a></p>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>Mark Rivers created this Python version from Craig’s IDL version.</dt><dd><p>Mark Rivers, University of Chicago
Building 434A, Argonne National Laboratory
9700 South Cass Avenue, Argonne, IL 60439
<a class="reference external" href="mailto:rivers&#37;&#52;&#48;cars&#46;uchicago&#46;edu">rivers<span>&#64;</span>cars<span>&#46;</span>uchicago<span>&#46;</span>edu</a>
Updated versions can be found at <a class="reference external" href="http://cars.uchicago.edu/software">http://cars.uchicago.edu/software</a></p>
</dd>
</dl>
</div></blockquote>
<dl>
<dt>Sergey Koposov converted the Mark’s Python version from Numeric to numpy</dt><dd><p>Sergey Koposov, University of Cambridge, Institute of Astronomy,
Madingley road, CB3 0HA, Cambridge, UK
<a class="reference external" href="mailto:koposov&#37;&#52;&#48;ast&#46;cam&#46;ac&#46;uk">koposov<span>&#64;</span>ast<span>&#46;</span>cam<span>&#46;</span>ac<span>&#46;</span>uk</a>
Updated versions can be found at <a class="reference external" href="http://code.google.com/p/astrolibpy/source/browse/trunk/">http://code.google.com/p/astrolibpy/source/browse/trunk/</a></p>
<blockquote>
<div><p>DESCRIPTION</p>
</div></blockquote>
</dd>
</dl>
<p>MPFIT uses the Levenberg-Marquardt technique to solve the
least-squares problem.  In its typical use, MPFIT will be used to
fit a user-supplied function (the “model”) to user-supplied data
points (the “data”) by adjusting a set of parameters.  MPFIT is
based upon MINPACK-1 (LMDIF.F) by More’ and collaborators.</p>
<p>For example, a researcher may think that a set of observed data
points is best modelled with a Gaussian curve.  A Gaussian curve is
parameterized by its mean, standard deviation and normalization.
MPFIT will, within certain constraints, find the set of parameters
which best fits the data.  The fit is “best” in the least-squares
sense; that is, the sum of the weighted squared differences between
the model and data is minimized.</p>
<p>The Levenberg-Marquardt technique is a particular strategy for
iteratively searching for the best fit.  This particular
implementation is drawn from MINPACK-1 (see NETLIB), and is much faster
and more accurate than the version provided in the Scientific Python package
in Scientific.Functions.LeastSquares.
This version allows upper and lower bounding constraints to be placed on each
parameter, or the parameter can be held fixed.</p>
<p>The user-supplied Python function should return an array of weighted
deviations between model and data.  In a typical scientific problem
the residuals should be weighted so that each deviate has a
gaussian sigma of 1.0.  If X represents values of the independent
variable, Y represents a measurement for each value of X, and ERR
represents the error in the measurements, then the deviates could
be calculated as follows:</p>
<blockquote>
<div><p>DEVIATES = (Y - F(X)) / ERR</p>
</div></blockquote>
<p>where F is the analytical function representing the model.  You are
recommended to use the convenience functions MPFITFUN and
MPFITEXPR, which are driver functions that calculate the deviates
for you.  If ERR are the 1-sigma uncertainties in Y, then</p>
<blockquote>
<div><p>TOTAL( DEVIATES^2 )</p>
</div></blockquote>
<p>will be the total chi-squared value.  MPFIT will minimize the
chi-square value.  The values of X, Y and ERR are passed through
MPFIT to the user-supplied function via the FUNCTKW keyword.</p>
<p>Simple constraints can be placed on parameter values by using the
PARINFO keyword to MPFIT.  See below for a description of this
keyword.</p>
<p>MPFIT does not perform more general optimization tasks.  See TNMIN
instead.  MPFIT is customized, based on MINPACK-1, to the
least-squares minimization problem.</p>
<blockquote>
<div><p>USER FUNCTION</p>
</div></blockquote>
<p>The user must define a function which returns the appropriate
values as specified above.  The function should return the weighted
deviations between the model and the data.  It should also return a status
flag and an optional partial derivative array.  For applications which
use finite-difference derivatives – the default – the user
function should be declared in the following way:</p>
<blockquote>
<div><dl class="simple">
<dt>def myfunct(p, fjac=None, x=None, y=None, err=None)</dt><dd><p># Parameter values are passed in “p”
# If fjac==None then partial derivatives should not be
# computed.  It will always be None if MPFIT is called with default
# flag.
model = F(x, p)
# Non-negative status value means MPFIT should continue, negative means
# stop the calculation.
status = 0
return([status, (y-model)/err]</p>
</dd>
</dl>
</div></blockquote>
<p>See below for applications with analytical derivatives.</p>
<p>The keyword parameters X, Y, and ERR in the example above are
suggestive but not required.  Any parameters can be passed to
MYFUNCT by using the functkw keyword to MPFIT.  Use MPFITFUN and
MPFITEXPR if you need ideas on how to do that.  The function <em>must</em>
accept a parameter list, P.</p>
<p>In general there are no restrictions on the number of dimensions in
X, Y or ERR.  However the deviates <em>must</em> be returned in a
one-dimensional Numeric array of type Float.</p>
<p>User functions may also indicate a fatal error condition using the
status return described above. If status is set to a number between
-15 and -1 then MPFIT will stop the calculation and return to the caller.</p>
<blockquote>
<div><p>ANALYTIC DERIVATIVES</p>
</div></blockquote>
<p>In the search for the best-fit solution, MPFIT by default
calculates derivatives numerically via a finite difference
approximation.  The user-supplied function need not calculate the
derivatives explicitly.  However, if you desire to compute them
analytically, then the AUTODERIVATIVE=0 keyword must be passed to MPFIT.
As a practical matter, it is often sufficient and even faster to allow
MPFIT to calculate the derivatives numerically, and so
AUTODERIVATIVE=0 is not necessary.</p>
<p>If AUTODERIVATIVE=0 is used then the user function must check the parameter
FJAC, and if FJAC!=None then return the partial derivative array in the
return list.</p>
<blockquote>
<div><dl>
<dt>def myfunct(p, fjac=None, x=None, y=None, err=None)</dt><dd><p># Parameter values are passed in “p”
# If FJAC!=None then partial derivatives must be comptuer.
# FJAC contains an array of len(p), where each entry
# is 1 if that parameter is free and 0 if it is fixed.
model = F(x, p)
Non-negative status value means MPFIT should continue, negative means
# stop the calculation.
status = 0
if (dojac):</p>
<blockquote>
<div><p>pderiv = zeros([len(x), len(p)], Float)
for j in range(len(p)):</p>
<blockquote>
<div><p>pderiv[:,j] = FGRAD(x, p, j)</p>
</div></blockquote>
</div></blockquote>
<dl class="simple">
<dt>else:</dt><dd><p>pderiv = None</p>
</dd>
</dl>
<p>return([status, (y-model)/err, pderiv]</p>
</dd>
</dl>
</div></blockquote>
<p>where FGRAD(x, p, i) is a user function which must compute the
derivative of the model with respect to parameter P[i] at X.  When
finite differencing is used for computing derivatives (ie, when
AUTODERIVATIVE=1), or when MPFIT needs only the errors but not the
derivatives the parameter FJAC=None.</p>
<p>Derivatives should be returned in the PDERIV array. PDERIV should be an m x
n array, where m is the number of data points and n is the number
of parameters.  dp[i,j] is the derivative at the ith point with
respect to the jth parameter.</p>
<p>The derivatives with respect to fixed parameters are ignored; zero
is an appropriate value to insert for those derivatives.  Upon
input to the user function, FJAC is set to a vector with the same
length as P, with a value of 1 for a parameter which is free, and a
value of zero for a parameter which is fixed (and hence no
derivative needs to be calculated).</p>
<p>If the data is higher than one dimensional, then the <em>last</em>
dimension should be the parameter dimension.  Example: fitting a
50x50 image, “dp” should be 50x50xNPAR.</p>
<blockquote>
<div><p>CONSTRAINING PARAMETER VALUES WITH THE PARINFO KEYWORD</p>
</div></blockquote>
<p>The behavior of MPFIT can be modified with respect to each
parameter to be fitted.  A parameter value can be fixed; simple
boundary constraints can be imposed; limitations on the parameter
changes can be imposed; properties of the automatic derivative can
be modified; and parameters can be tied to one another.</p>
<p>These properties are governed by the PARINFO structure, which is
passed as a keyword parameter to MPFIT.</p>
<p>PARINFO should be a list of dictionaries, one list entry for each parameter.
Each parameter is associated with one element of the array, in
numerical order.  The dictionary can have the following keys
(none are required, keys are case insensitive):</p>
<blockquote>
<div><dl>
<dt>‘value’ - the starting parameter value (but see the START_PARAMS</dt><dd><p>parameter for more information).</p>
</dd>
<dt>‘fixed’ - a boolean value, whether the parameter is to be held</dt><dd><p>fixed or not.  Fixed parameters are not varied by
MPFIT, but are passed on to MYFUNCT for evaluation.</p>
</dd>
<dt>‘limited’ - a two-element boolean array.  If the first/second</dt><dd><p>element is set, then the parameter is bounded on the
lower/upper side.  A parameter can be bounded on both
sides.  Both LIMITED and LIMITS must be given
together.</p>
</dd>
<dt>‘limits’ - a two-element float array.  Gives the</dt><dd><p>parameter limits on the lower and upper sides,
respectively.  Zero, one or two of these values can be
set, depending on the values of LIMITED.  Both LIMITED
and LIMITS must be given together.</p>
</dd>
<dt>‘parname’ - a string, giving the name of the parameter.  The</dt><dd><p>fitting code of MPFIT does not use this tag in any
way.  However, the default iterfunct will print the
parameter name if available.</p>
</dd>
<dt>‘step’ - the step size to be used in calculating the numerical</dt><dd><p>derivatives.  If set to zero, then the step size is
computed automatically.  Ignored when AUTODERIVATIVE=0.</p>
</dd>
<dt>‘mpside’ - the sidedness of the finite difference when computing</dt><dd><blockquote>
<div><p>numerical derivatives.  This field can take four
values:</p>
<blockquote>
<div><blockquote>
<div><p>0 - one-sided derivative computed automatically
1 - one-sided derivative (f(x+h) - f(x)  )/h</p>
</div></blockquote>
<dl class="simple">
<dt>-1 - one-sided derivative (f(x)   - f(x-h))/h</dt><dd><p>2 - two-sided derivative (f(x+h) - f(x-h))/(2*h)</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>Where H is the STEP parameter described above.  The
“automatic” one-sided derivative method will chose a
direction for the finite difference which does not
violate any constraints.  The other methods do not
perform this check.  The two-sided method is in
principle more precise, but requires twice as many
function evaluations.  Default: 0.</p>
</dd>
<dt>‘mpmaxstep’ - the maximum change to be made in the parameter</dt><dd><p>value.  During the fitting process, the parameter
will never be changed by more than this value in
one iteration.</p>
<p>A value of 0 indicates no maximum.  Default: 0.</p>
</dd>
<dt>‘tied’ - a string expression which “ties” the parameter to other</dt><dd><p>free or fixed parameters.  Any expression involving
constants and the parameter array P are permitted.
Example: if parameter 2 is always to be twice parameter
1 then use the following: parinfo(2).tied = ‘2 * p(1)’.
Since they are totally constrained, tied parameters are
considered to be fixed; no errors are computed for them.
[ NOTE: the PARNAME can’t be used in expressions. ]</p>
</dd>
<dt>‘mpprint’ - if set to 1, then the default iterfunct will print the</dt><dd><p>parameter value.  If set to 0, the parameter value
will not be printed.  This tag can be used to
selectively print only a few parameter values out of
many.  Default: 1 (all parameters printed)</p>
</dd>
</dl>
</div></blockquote>
<p>Future modifications to the PARINFO structure, if any, will involve
adding dictionary tags beginning with the two letters “MP”.
Therefore programmers are urged to avoid using tags starting with
the same letters; otherwise they are free to include their own
fields within the PARINFO structure, and they will be ignored.</p>
<p>PARINFO Example:
parinfo = [{‘value’:0., ‘fixed’:0, ‘limited’:[0,0], ‘limits’:[0.,0.]}</p>
<blockquote>
<div><p>for i in range(5)]</p>
</div></blockquote>
<p>parinfo[0][‘fixed’] = 1
parinfo[4][‘limited’][0] = 1
parinfo[4][‘limits’][0]  = 50.
values = [5.7, 2.2, 500., 1.5, 2000.]
for i in range(5): parinfo[i][‘value’]=values[i]</p>
<p>A total of 5 parameters, with starting values of 5.7,
2.2, 500, 1.5, and 2000 are given.  The first parameter
is fixed at a value of 5.7, and the last parameter is
constrained to be above 50.</p>
<blockquote>
<div><blockquote>
<div><p>EXAMPLE</p>
</div></blockquote>
<p>import mpfit
import numpy.oldnumeric as Numeric
x = arange(100, float)
p0 = [5.7, 2.2, 500., 1.5, 2000.]
y = ( p[0] + p[1]*[x] + p[2]*[x**2] + p[3]*sqrt(x) +</p>
<blockquote>
<div><p>p[4]*log(x))</p>
</div></blockquote>
<p>fa = {‘x’:x, ‘y’:y, ‘err’:err}
m = mpfit(‘myfunct’, p0, functkw=fa)
print ‘status = ‘, m.status
if (m.status &lt;= 0): print ‘error message = ‘, m.errmsg
print ‘parameters = ‘, m.params</p>
<p>Minimizes sum of squares of MYFUNCT.  MYFUNCT is called with the X,
Y, and ERR keyword parameters that are given by FUNCTKW.  The
results can be obtained from the returned object m.</p>
<blockquote>
<div><p>THEORY OF OPERATION</p>
</div></blockquote>
<p>There are many specific strategies for function minimization.  One
very popular technique is to use function gradient information to
realize the local structure of the function.  Near a local minimum
the function value can be taylor expanded about x0 as follows:</p>
<blockquote>
<div><blockquote>
<div><dl class="simple">
<dt>f(x) = f(x0) + f’(x0) . (x-x0) + (1/2) (x-x0) . f’’(x0) . (x-x0)</dt><dd><p>—–   —————   ——————————-  (1)</p>
</dd>
</dl>
</div></blockquote>
<p>Order  0th               1st                                     2nd</p>
</div></blockquote>
<p>Here f’(x) is the gradient vector of f at x, and f’’(x) is the
Hessian matrix of second derivatives of f at x.  The vector x is
the set of function parameters, not the measured data vector.  One
can find the minimum of f, f(xm) using Newton’s method, and
arrives at the following linear equation:</p>
<blockquote>
<div><p>f’’(x0) . (xm-x0) = - f’(x0)                                                  (2)</p>
</div></blockquote>
<p>If an inverse can be found for f’’(x0) then one can solve for
(xm-x0), the step vector from the current position x0 to the new
projected minimum.  Here the problem has been linearized (ie, the
gradient information is known to first order).  f’’(x0) is
symmetric n x n matrix, and should be positive definite.</p>
<p>The Levenberg - Marquardt technique is a variation on this theme.
It adds an additional diagonal term to the equation which may aid the
convergence properties:</p>
<blockquote>
<div><p>(f’’(x0) + nu I) . (xm-x0) = -f’(x0)                            (2a)</p>
</div></blockquote>
<p>where I is the identity matrix.  When nu is large, the overall
matrix is diagonally dominant, and the iterations follow steepest
descent.  When nu is small, the iterations are quadratically
convergent.</p>
<p>In principle, if f’’(x0) and f’(x0) are known then xm-x0 can be
determined.  However the Hessian matrix is often difficult or
impossible to compute.  The gradient f’(x0) may be easier to
compute, if even by finite difference techniques.  So-called
quasi-Newton techniques attempt to successively estimate f’’(x0)
by building up gradient information as the iterations proceed.</p>
<p>In the least squares problem there are further simplifications
which assist in solving eqn (2).  The function to be minimized is
a sum of squares:</p>
<blockquote>
<div><p>f = Sum(hi^2)                                                                                 (3)</p>
</div></blockquote>
<p>where hi is the ith residual out of m residuals as described
above.  This can be substituted back into eqn (2) after computing
the derivatives:</p>
<blockquote>
<div><p>f’  = 2 Sum(hi  hi’)
f’’ = 2 Sum(hi’ hj’) + 2 Sum(hi hi’’)                                (4)</p>
</div></blockquote>
<p>If one assumes that the parameters are already close enough to a
minimum, then one typically finds that the second term in f’’ is
negligible [or, in any case, is too difficult to compute].  Thus,
equation (2) can be solved, at least approximately, using only
gradient information.</p>
<p>In matrix notation, the combination of eqns (2) and (4) becomes:</p>
<blockquote>
<div><p>hT’ . h’ . dx = - hT’ . h                                                 (5)</p>
</div></blockquote>
<p>Where h is the residual vector (length m), hT is its transpose, h’
is the Jacobian matrix (dimensions n x m), and dx is (xm-x0).  The
user function supplies the residual vector h, and in some cases h’
when it is not found by finite differences (see MPFIT_FDJAC2,
which finds h and hT’).  Even if dx is not the best absolute step
to take, it does provide a good estimate of the best <em>direction</em>,
so often a line minimization will occur along the dx vector
direction.</p>
<p>The method of solution employed by MINPACK is to form the Q . R
factorization of h’, where Q is an orthogonal matrix such that QT .
Q = I, and R is upper right triangular.  Using h’ = Q . R and the
ortogonality of Q, eqn (5) becomes</p>
<blockquote>
<div><dl class="simple">
<dt>(RT . QT) . (Q . R) . dx = - (RT . QT) . h</dt><dd><dl class="simple">
<dt>RT . R . dx = - RT . QT . h             (6)</dt><dd><p>R . dx = - QT . h</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<p>where the last statement follows because R is upper triangular.
Here, R, QT and h are known so this is a matter of solving for dx.
The routine MPFIT_QRFAC provides the QR factorization of h, with
pivoting, and MPFIT_QRSOLV provides the solution for dx.</p>
<blockquote>
<div><p>REFERENCES</p>
</div></blockquote>
<p>MINPACK-1, Jorge More’, available from netlib (www.netlib.org).
“Optimization Software Guide,” Jorge More’ and Stephen Wright,</p>
<blockquote>
<div><p>SIAM, <em>Frontiers in Applied Mathematics</em>, Number 14.</p>
</div></blockquote>
<dl>
<dt>More’, Jorge J., “The Levenberg-Marquardt Algorithm:</dt><dd><p>Implementation and Theory,” in <em>Numerical Analysis</em>, ed. Watson,
G. A., Lecture Notes in Mathematics 630, Springer-Verlag, 1977.</p>
<blockquote>
<div><p>MODIFICATION HISTORY</p>
</div></blockquote>
</dd>
</dl>
<p>Translated from MINPACK-1 in FORTRAN, Apr-Jul 1998, CM</p>
</div></blockquote>
<p>Copyright (C) 1997-2002, Craig Markwardt
This software is provided as is without any warranty whatsoever.
Permission to use, copy, modify, and distribute modified or
unmodified copies is granted, provided this copyright and disclaimer
are included unchanged.</p>
<blockquote>
<div><p>Translated from MPFIT (Craig Markwardt’s IDL package) to Python,
August, 2002.  Mark Rivers
Converted from Numeric to numpy (Sergey Koposov, July 2008)</p>
</div></blockquote>
</div></blockquote>
<dl class="class">
<dt id="FASMA.mpfit.machar">
<em class="property">class </em><code class="sig-prename descclassname">FASMA.mpfit.</code><code class="sig-name descname">machar</code><span class="sig-paren">(</span><em class="sig-param">double=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#machar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.machar" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
</dd></dl>

<dl class="class">
<dt id="FASMA.mpfit.mpfit">
<em class="property">class </em><code class="sig-prename descclassname">FASMA.mpfit.</code><code class="sig-name descname">mpfit</code><span class="sig-paren">(</span><em class="sig-param">fcn</em>, <em class="sig-param">xall=None</em>, <em class="sig-param">functkw={}</em>, <em class="sig-param">parinfo=None</em>, <em class="sig-param">ftol=1e-10</em>, <em class="sig-param">xtol=1e-10</em>, <em class="sig-param">gtol=1e-10</em>, <em class="sig-param">damp=0.0</em>, <em class="sig-param">maxiter=200</em>, <em class="sig-param">factor=100.0</em>, <em class="sig-param">nprint=1</em>, <em class="sig-param">iterfunct='default'</em>, <em class="sig-param">iterkw={}</em>, <em class="sig-param">nocovar=0</em>, <em class="sig-param">rescale=0</em>, <em class="sig-param">autoderivative=1</em>, <em class="sig-param">quiet=0</em>, <em class="sig-param">diag=None</em>, <em class="sig-param">epsfcn=None</em>, <em class="sig-param">debug=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="attribute">
<dt id="FASMA.mpfit.mpfit.blas_enorm32">
<code class="sig-name descname">blas_enorm32</code><em class="property"> = &lt;fortran dnrm2&gt;</em><a class="headerlink" href="#FASMA.mpfit.mpfit.blas_enorm32" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="FASMA.mpfit.mpfit.blas_enorm64">
<code class="sig-name descname">blas_enorm64</code><em class="property"> = &lt;fortran dnrm2&gt;</em><a class="headerlink" href="#FASMA.mpfit.mpfit.blas_enorm64" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.calc_covar">
<code class="sig-name descname">calc_covar</code><span class="sig-paren">(</span><em class="sig-param">rr</em>, <em class="sig-param">ipvt=None</em>, <em class="sig-param">tol=1e-14</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.calc_covar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.calc_covar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.call">
<code class="sig-name descname">call</code><span class="sig-paren">(</span><em class="sig-param">fcn</em>, <em class="sig-param">x</em>, <em class="sig-param">functkw</em>, <em class="sig-param">fjac=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.call"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.call" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.defiter">
<code class="sig-name descname">defiter</code><span class="sig-paren">(</span><em class="sig-param">fcn</em>, <em class="sig-param">x</em>, <em class="sig-param">iter</em>, <em class="sig-param">fnorm=None</em>, <em class="sig-param">functkw=None</em>, <em class="sig-param">quiet=0</em>, <em class="sig-param">iterstop=None</em>, <em class="sig-param">parinfo=None</em>, <em class="sig-param">format=None</em>, <em class="sig-param">pformat='%.10g'</em>, <em class="sig-param">dof=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.defiter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.defiter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.enorm">
<code class="sig-name descname">enorm</code><span class="sig-paren">(</span><em class="sig-param">vec</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.enorm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.enorm" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.fdjac2">
<code class="sig-name descname">fdjac2</code><span class="sig-paren">(</span><em class="sig-param">fcn</em>, <em class="sig-param">x</em>, <em class="sig-param">fvec</em>, <em class="sig-param">step=None</em>, <em class="sig-param">ulimited=None</em>, <em class="sig-param">ulimit=None</em>, <em class="sig-param">dside=None</em>, <em class="sig-param">epsfcn=None</em>, <em class="sig-param">autoderivative=1</em>, <em class="sig-param">functkw=None</em>, <em class="sig-param">xall=None</em>, <em class="sig-param">ifree=None</em>, <em class="sig-param">dstep=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.fdjac2"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.fdjac2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.lmpar">
<code class="sig-name descname">lmpar</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">ipvt</em>, <em class="sig-param">diag</em>, <em class="sig-param">qtb</em>, <em class="sig-param">delta</em>, <em class="sig-param">x</em>, <em class="sig-param">sdiag</em>, <em class="sig-param">par=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.lmpar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.lmpar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.parinfo">
<code class="sig-name descname">parinfo</code><span class="sig-paren">(</span><em class="sig-param">parinfo=None</em>, <em class="sig-param">key='a'</em>, <em class="sig-param">default=None</em>, <em class="sig-param">n=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.parinfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.parinfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.qrfac">
<code class="sig-name descname">qrfac</code><span class="sig-paren">(</span><em class="sig-param">a</em>, <em class="sig-param">pivot=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.qrfac"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.qrfac" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.qrsolv">
<code class="sig-name descname">qrsolv</code><span class="sig-paren">(</span><em class="sig-param">r</em>, <em class="sig-param">ipvt</em>, <em class="sig-param">diag</em>, <em class="sig-param">qtb</em>, <em class="sig-param">sdiag</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.qrsolv"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.qrsolv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="FASMA.mpfit.mpfit.tie">
<code class="sig-name descname">tie</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">ptied=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/mpfit.html#mpfit.tie"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.mpfit.mpfit.tie" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-FASMA.observations">
<span id="fasma-observations-module"></span><h2>FASMA.observations module<a class="headerlink" href="#module-FASMA.observations" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="FASMA.observations.eso_fits">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">eso_fits</code><span class="sig-paren">(</span><em class="sig-param">hdulist</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#eso_fits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.eso_fits" title="Permalink to this definition">¶</a></dt>
<dd><p>A little demo utility to illustrate the ESO SDP 1D spectrum file format.
2017-Aug-08, archive(at)eso.org
The ESO 1D spectral format is compliant with the IVOA Spectrum data model.
Both the SPECTRUM 1.0 and SPECTRUM 2.0 versions are supported.
References:
ESO SDP standard: <a class="reference external" href="http://www.eso.org/sci/observing/phase3/p3sdpstd.pdf">http://www.eso.org/sci/observing/phase3/p3sdpstd.pdf</a>
ESO SDP FAQ page: <a class="reference external" href="http://www.eso.org/sci/observing/phase3/faq.html">http://www.eso.org/sci/observing/phase3/faq.html</a>
This script:      <a class="reference external" href="http://archive.eso.org/cms/eso-data/help/1dspectra.html">http://archive.eso.org/cms/eso-data/help/1dspectra.html</a></p>
<p>wave : raw observed wavelength
flux : raw observed flux</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.local_norm">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">local_norm</code><span class="sig-paren">(</span><em class="sig-param">obs_fname</em>, <em class="sig-param">r</em>, <em class="sig-param">snr</em>, <em class="sig-param">lol=1.0</em>, <em class="sig-param">plot=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#local_norm"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.local_norm" title="Permalink to this definition">¶</a></dt>
<dd><p>Very local Normalization function. Makes a linear fit from the maximum points
of each segment.
Input
—–
obs_fname : observations file
r : range of the interval
plot: True to visual check if normalization is correct, default: False</p>
<p>wave : wavelength
new_flux : normalized flux
delta_l : wavelenghth spacing</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.mad">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">mad</code><span class="sig-paren">(</span><em class="sig-param">data</em>, <em class="sig-param">axis=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#mad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.mad" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to calculate the median average deviation.</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.plot">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">plot</code><span class="sig-paren">(</span><em class="sig-param">xobs</em>, <em class="sig-param">yobs</em>, <em class="sig-param">xinit</em>, <em class="sig-param">yinit</em>, <em class="sig-param">xfinal</em>, <em class="sig-param">yfinal</em>, <em class="sig-param">res=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#plot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.plot" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to plot synthetic and observed spectra.
Input
—–
xobs : observed wavelength
yobs : observed flux
xinit : synthetic wavelength with initial parameters
yinit : synthetic flux with initial parameters
xfinal : synthetic wavelength with final parameters
yfinal : synthetic flux with final parameters
res: Flag to plot residuals</p>
<p>plots</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.read_obs_intervals">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">read_obs_intervals</code><span class="sig-paren">(</span><em class="sig-param">obs_fname</em>, <em class="sig-param">r</em>, <em class="sig-param">snr=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#read_obs_intervals"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.read_obs_intervals" title="Permalink to this definition">¶</a></dt>
<dd><p>Read only the spectral chunks from the observed spectrum and normalize
the regions.
Input
—–
fname : filename of the spectrum.
r : ranges of wavelength intervals where the observed spectrum is cut
(starting and ending wavelength)
snr: signal-to-noise</p>
<p>xobs : observed normalized wavelength
yobs : observed normalized flux
delta_l : wavelenghth spacing</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.read_observations">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">read_observations</code><span class="sig-paren">(</span><em class="sig-param">fname</em>, <em class="sig-param">start_synth</em>, <em class="sig-param">end_synth</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#read_observations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.read_observations" title="Permalink to this definition">¶</a></dt>
<dd><p>Read observed spectrum of different types and return wavelength and flux.
Input
—–
fname : filename of the spectrum. These are the approved formats: ‘.dat’, ‘.txt’,
‘.spec’, ‘.fits’.
start_synth : starting wavelength where the observed spectrum is cut
end_synth : ending wavelength where the observed spectrum is cut</p>
<p>wave_obs : raw observed wavelength
flux_obs : raw observed flux</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.observations.snr">
<code class="sig-prename descclassname">FASMA.observations.</code><code class="sig-name descname">snr</code><span class="sig-paren">(</span><em class="sig-param">fname</em>, <em class="sig-param">plot=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/observations.html#snr"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.observations.snr" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate SNR using for various intervals.
Input
—-
fname : spectrum
plot : plot snr fit</p>
<p>snr : snr value averaged from the continuum intervals</p>
</dd></dl>

</div>
<div class="section" id="module-FASMA.solar_abundance">
<span id="fasma-solar-abundance-module"></span><h2>FASMA.solar_abundance module<a class="headerlink" href="#module-FASMA.solar_abundance" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-FASMA.synthDriver">
<span id="fasma-synthdriver-module"></span><h2>FASMA.synthDriver module<a class="headerlink" href="#module-FASMA.synthDriver" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="FASMA.synthDriver.FASMA">
<em class="property">class </em><code class="sig-prename descclassname">FASMA.synthDriver.</code><code class="sig-name descname">FASMA</code><span class="sig-paren">(</span><em class="sig-param">cfgfile='config.yml'</em>, <em class="sig-param">overwrite=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="method">
<dt id="FASMA.synthDriver.FASMA.configure">
<code class="sig-name descname">configure</code><span class="sig-paren">(</span><em class="sig-param">cfgfile='config.yml'</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.configure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.configure" title="Permalink to this definition">¶</a></dt>
<dd><p>Create configuration file from kwargs.
Otherwise set to default.</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.minizationElementRunner">
<code class="sig-name descname">minizationElementRunner</code><span class="sig-paren">(</span><em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.minizationElementRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.minizationElementRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to run the minimization routine for element abundances.</p>
<p>params : output parameters</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.minizationRunner">
<code class="sig-name descname">minizationRunner</code><span class="sig-paren">(</span><em class="sig-param">p=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.minizationRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.minizationRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to run the minimization routine</p>
<p>params : output parameters</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.plotRunner">
<code class="sig-name descname">plotRunner</code><span class="sig-paren">(</span><em class="sig-param">x=None</em>, <em class="sig-param">y=None</em>, <em class="sig-param">xs=None</em>, <em class="sig-param">ys=None</em>, <em class="sig-param">xf=None</em>, <em class="sig-param">yf=None</em>, <em class="sig-param">res=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.plotRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.plotRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to plot spectra with or without residuals.</p>
<p>plots</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.result">
<code class="sig-name descname">result</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.result"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.result" title="Permalink to this definition">¶</a></dt>
<dd><p>If any, get the output parameters.</p>
<p>status : if None, no minimization happened</p>
<p>params : output parameters in dictionary</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.saveRunner">
<code class="sig-name descname">saveRunner</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.saveRunner"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.saveRunner" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to save spectra in a fits like format in the results/ folder.
If initial spectrum exists, save it.</p>
<p>saved spectrum</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.synthDriver.FASMA.synthdriver">
<code class="sig-name descname">synthdriver</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthDriver.html#FASMA.synthdriver"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthDriver.FASMA.synthdriver" title="Permalink to this definition">¶</a></dt>
<dd><p>A function to connect all. This function applies the options set by
the user in the config.yml file.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-FASMA.synthetic">
<span id="fasma-synthetic-module"></span><h2>FASMA.synthetic module<a class="headerlink" href="#module-FASMA.synthetic" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="FASMA.synthetic.broadening">
<code class="sig-prename descclassname">FASMA.synthetic.</code><code class="sig-name descname">broadening</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">vsini</em>, <em class="sig-param">vmac</em>, <em class="sig-param">resolution=None</em>, <em class="sig-param">epsilon=0.6</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthetic.html#broadening"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthetic.broadening" title="Permalink to this definition">¶</a></dt>
<dd><p>This function broadens the given data using velocity kernels,
e.g. instrumental profile, vsini and vmac.
Based on <a class="reference external" href="http://www.hs.uni-hamburg.de/DE/Ins/Per/Czesla/PyA/PyA/pyaslDoc/aslDoc/broadening.html">http://www.hs.uni-hamburg.de/DE/Ins/Per/Czesla/PyA/PyA/pyaslDoc/aslDoc/broadening.html</a>
Input
—-
x : ndarray</p>
<blockquote>
<div><p>wavelength</p>
</div></blockquote>
<dl class="simple">
<dt>y<span class="classifier">ndarray</span></dt><dd><p>flux</p>
</dd>
<dt>resolution<span class="classifier">float</span></dt><dd><p>Instrumental resolution (lambda /delta lambda)</p>
</dd>
<dt>vsini<span class="classifier">float</span></dt><dd><p>vsini in km/s</p>
</dd>
<dt>vmac<span class="classifier">float</span></dt><dd><p>vmac in km/s</p>
</dd>
</dl>
<p>epsilon : limb-darkening parameter</p>
<dl class="simple">
<dt>y_broad<span class="classifier">ndarray</span></dt><dd><p>Broadened flux</p>
</dd>
<dt>x<span class="classifier">ndarray</span></dt><dd><p>Same wavelength</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="FASMA.synthetic.read_linelist">
<code class="sig-prename descclassname">FASMA.synthetic.</code><code class="sig-name descname">read_linelist</code><span class="sig-paren">(</span><em class="sig-param">fname</em>, <em class="sig-param">intname='intervals.lst'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthetic.html#read_linelist"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthetic.read_linelist" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the line list (atomic data) and the file which includes the ranges
where the synthesis will happen.</p>
<dl class="simple">
<dt>fname<span class="classifier">str</span></dt><dd><p>File that contains the linelist</p>
</dd>
<dt>intname<span class="classifier">str</span></dt><dd><p>File that contains the intervals</p>
</dd>
</dl>
<p>ranges : wavelength ranges of the linelist
atomic : atomic data</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.synthetic.read_linelist_elem">
<code class="sig-prename descclassname">FASMA.synthetic.</code><code class="sig-name descname">read_linelist_elem</code><span class="sig-paren">(</span><em class="sig-param">fname</em>, <em class="sig-param">element=None</em>, <em class="sig-param">intname='intervals_elements.lst'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthetic.html#read_linelist_elem"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthetic.read_linelist_elem" title="Permalink to this definition">¶</a></dt>
<dd><p>Read the line list (atomic data) and the file which includes the ranges
where the synthesis will happen for the element abundances.</p>
<dl class="simple">
<dt>fname<span class="classifier">str</span></dt><dd><p>File that contains the linelist</p>
</dd>
<dt>element<span class="classifier">str</span></dt><dd><p>The element to be searched in the line list</p>
</dd>
<dt>intname<span class="classifier">str</span></dt><dd><p>File that contains the central line where -+2.0 AA{} are added to create
the interval around each line.</p>
</dd>
</dl>
<p>ranges : wavelength ranges of the linelist
atomic : atomic data</p>
</dd></dl>

<dl class="function">
<dt id="FASMA.synthetic.save_synth_spec">
<code class="sig-prename descclassname">FASMA.synthetic.</code><code class="sig-name descname">save_synth_spec</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">initial=None</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/synthetic.html#save_synth_spec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.synthetic.save_synth_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Save synthetic spectrum of all intervals</p>
<dl class="simple">
<dt>x<span class="classifier">ndarray</span></dt><dd><p>Wavelength</p>
</dd>
<dt>y<span class="classifier">ndarray</span></dt><dd><p>Flux</p>
</dd>
<dt>initial<span class="classifier">list</span></dt><dd><p>Set of parameters to name the new file, else it is named ‘synthetic.spec’.</p>
</dd>
</dl>
<p>fname fits file</p>
</dd></dl>

</div>
<div class="section" id="module-FASMA.utils">
<span id="fasma-utils-module"></span><h2>FASMA.utils module<a class="headerlink" href="#module-FASMA.utils" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="FASMA.utils.GetModels">
<em class="property">class </em><code class="sig-prename descclassname">FASMA.utils.</code><code class="sig-name descname">GetModels</code><span class="sig-paren">(</span><em class="sig-param">teff</em>, <em class="sig-param">logg</em>, <em class="sig-param">feh</em>, <em class="sig-param">atmtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/utils.html#GetModels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.utils.GetModels" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Find the names of the closest grid points for a given effective
temperature, surface gravity, and iron abundance (proxy for metallicity).</p>
<dl class="simple">
<dt>teff<span class="classifier">int</span></dt><dd><p>The effective temperature (K) for the model atmosphere</p>
</dd>
<dt>logg<span class="classifier">float</span></dt><dd><p>The surface gravity (logarithmic in cgs) for the model atmosphere</p>
</dd>
<dt>feh<span class="classifier">float</span></dt><dd><p>The metallicity for the model atmosphere</p>
</dd>
<dt>atmtype<span class="classifier">str</span></dt><dd><p>The type of atmosphere models to use. Currently only Kurucz from ‘95.</p>
</dd>
</dl>
<dl class="method">
<dt id="FASMA.utils.GetModels.getmodels">
<code class="sig-name descname">getmodels</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/utils.html#GetModels.getmodels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.utils.GetModels.getmodels" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the atmosphere models surrounding the requested atmospheric
parameters. This function should be called before using the interpolation
code within FASMA.</p>
<dl class="simple">
<dt>models<span class="classifier">list</span></dt><dd><p>List with path to 8 models the two closest in each parameter space (4x2x2)</p>
</dd>
<dt>teff_model<span class="classifier">list</span></dt><dd><p>The four closest effective temperatures in the grid</p>
</dd>
<dt>logg_model<span class="classifier">list</span></dt><dd><p>The two closest surface gravities in the grid</p>
</dd>
<dt>feh_model<span class="classifier">list</span></dt><dd><p>The two closest metallicities in the grid</p>
</dd>
</dl>
<p>The last three return values are used for the interpolation to do some
mapping. If only the paths to the models are needed, do not pay attention
to them.</p>
</dd></dl>

<dl class="method">
<dt id="FASMA.utils.GetModels.neighbour">
<code class="sig-name descname">neighbour</code><span class="sig-paren">(</span><em class="sig-param">arr</em>, <em class="sig-param">val</em>, <em class="sig-param">k=2</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/utils.html#GetModels.neighbour"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.utils.GetModels.neighbour" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the K surrounding neighbours of an array, given a certain value.</p>
<dl class="simple">
<dt>arr<span class="classifier">array_like</span></dt><dd><p>The array from which some neighbours should be found (assumed sorted).</p>
</dd>
<dt>val<span class="classifier">float</span></dt><dd><p>The value to found neighbours around in arr</p>
</dd>
<dt>k<span class="classifier">int</span></dt><dd><p>The number of neighbours to find</p>
</dd>
</dl>
<dl class="simple">
<dt>array<span class="classifier">list</span></dt><dd><p>A list with the k surrounding neighbours</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="FASMA.utils.fun_moog_synth">
<code class="sig-prename descclassname">FASMA.utils.</code><code class="sig-name descname">fun_moog_synth</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">atmtype</em>, <em class="sig-param">abund=0.0</em>, <em class="sig-param">par='batch.par'</em>, <em class="sig-param">ranges=None</em>, <em class="sig-param">results='summary.out'</em>, <em class="sig-param">driver='synth'</em>, <em class="sig-param">version=2014</em>, <em class="sig-param">**options</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/FASMA/utils.html#fun_moog_synth"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#FASMA.utils.fun_moog_synth" title="Permalink to this definition">¶</a></dt>
<dd><p>Run MOOG and create synthetic spectrum for the synth driver.
:x: A tuple/list with values (teff, logg, [Fe/H], vt, vmic, vmac)
:atmtype: model atmosphere
:abund: abundance of specific species
:ranges: array of intervals for the synthesis
:par: The parameter file (batch.par)
:results: The summary file
:driver: Which driver to use when running MOOG
:version: The version of MOOG
:returns: w, f : wavelength and flux</p>
</dd></dl>

</div>
<div class="section" id="module-FASMA">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-FASMA" title="Permalink to this headline">¶</a></h2>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">FASMA</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="FASMA.tests.html">FASMA.tests package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, FASMA.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/FASMA.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>